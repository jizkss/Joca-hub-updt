local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Atualizado para o novo assetId
local IMAGE_ASSET_ID = "rbxassetid://115538776946656"

-- GUI principal do Hub
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "JocaHubGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer.PlayerGui

-- Ícone para abrir/fechar o menu
local IconButton = Instance.new("ImageButton")
IconButton.Name = "OpenCloseButton"
IconButton.Size = UDim2.new(0, 52, 0, 52)
IconButton.Position = UDim2.new(0, 20, 1, -72)
IconButton.AnchorPoint = Vector2.new(0, 1)
IconButton.BackgroundTransparency = 1
IconButton.Image = IMAGE_ASSET_ID
IconButton.Parent = ScreenGui
IconButton.ZIndex = 10

-- Sombra atrás do ícone
local IconShadow = Instance.new("ImageLabel")
IconShadow.Name = "IconShadow"
IconShadow.BackgroundTransparency = 1
IconShadow.Image = "rbxassetid://1316045217"
IconShadow.Size = UDim2.new(1, 22, 1, 22)
IconShadow.Position = UDim2.new(0, -11, 0, -11)
IconShadow.ImageTransparency = 0.75
IconShadow.ImageColor3 = Color3.new(0,0,0)
IconShadow.ZIndex = 9
IconShadow.Parent = IconButton

-- Arrastar o ícone
local iconDragging = false
local iconDragStart
local iconStartPos

IconButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        iconDragging = true
        iconDragStart = input.Position
        iconStartPos = IconButton.Position
    end
end)

IconButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        iconDragging = false
    end
end)

UIS.InputChanged:Connect(function(input)
    if iconDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - iconDragStart
        local newPos = iconStartPos + UDim2.new(0, delta.X, 0, delta.Y)
        -- Garantir que fique na tela:
        newPos = UDim2.new(
            0, math.clamp(newPos.X.Offset, 0, ScreenGui.AbsoluteSize.X - IconButton.AbsoluteSize.X),
            0, math.clamp(newPos.Y.Offset, 0, ScreenGui.AbsoluteSize.Y - IconButton.AbsoluteSize.Y)
        )
        IconButton.Position = UDim2.new(
            0, newPos.X.Offset,
            0, newPos.Y.Offset
        )
        IconButton.AnchorPoint = Vector2.new(0, 0)
        IconShadow.Position = UDim2.new(0, -11, 0, -11)
    end
end)

-- Menu principal (Frame)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "JocaHubMain"
MainFrame.Size = UDim2.new(0, 370, 0, 290)
MainFrame.Position = UDim2.new(0, 90, 1, -310)
MainFrame.AnchorPoint = Vector2.new(0, 1)
MainFrame.BackgroundColor3 = Color3.fromRGB(240, 240, 255)
MainFrame.BackgroundTransparency = 0.08
MainFrame.Visible = false
MainFrame.Parent = ScreenGui
MainFrame.Active = true

-- Bordas arredondadas do menu
local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 18)
MainCorner.Parent = MainFrame

-- Sombra preta do menu
local MainShadow = Instance.new("ImageLabel")
MainShadow.Name = "MainShadow"
MainShadow.BackgroundTransparency = 1
MainShadow.Image = "rbxassetid://1316045217"
MainShadow.Size = UDim2.new(1, 28, 1, 28)
MainShadow.Position = UDim2.new(0, -14, 0, -14)
MainShadow.ImageTransparency = 0.8
MainShadow.ImageColor3 = Color3.new(0,0,0)
MainShadow.ZIndex = 0
MainShadow.Parent = MainFrame

-- Título do menu
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 54)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Joca hub"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 28
Title.TextColor3 = Color3.fromRGB(55, 20, 90)
Title.TextStrokeTransparency = 0.9
Title.TextYAlignment = Enum.TextYAlignment.Center
Title.TextXAlignment = Enum.TextXAlignment.Center
Title.Parent = MainFrame
Title.ZIndex = 2

-- Botões de categoria (ESP, Aimbot, Misc)
local categories = {"ESP", "Aimbot", "Misc"}
local buttons = {}
local selectedCategory = 1

for i, name in ipairs(categories) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 90, 0, 34)
    btn.Position = UDim2.new(0, 24 + 110*(i-1), 0, 62)
    btn.BackgroundColor3 = i == 1 and Color3.fromRGB(220,200,255) or Color3.fromRGB(235,235,255)
    btn.TextColor3 = i == 1 and Color3.fromRGB(55, 20, 90) or Color3.fromRGB(60, 60, 80)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 20
    btn.Text = name
    btn.Parent = MainFrame
    btn.ZIndex = 2
    btn.AutoButtonColor = true

    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 10)
    btnCorner.Parent = btn

    buttons[i] = btn
end

-- Conteúdo das categorias (Exemplo: só texto centralizado)
local ContentLabel = Instance.new("TextLabel")
ContentLabel.Size = UDim2.new(1, -40, 1, -120)
ContentLabel.Position = UDim2.new(0, 20, 0, 108)
ContentLabel.BackgroundTransparency = 1
ContentLabel.Text = "Selecione uma categoria"
ContentLabel.Font = Enum.Font.Gotham
ContentLabel.TextSize = 20
ContentLabel.TextColor3 = Color3.fromRGB(30, 30, 60)
ContentLabel.TextWrapped = true
ContentLabel.TextXAlignment = Enum.TextXAlignment.Center
ContentLabel.TextYAlignment = Enum.TextYAlignment.Center
ContentLabel.Parent = MainFrame
ContentLabel.ZIndex = 2

local categoryContents = {
    "Esp roxo.\n\n(Use a tecla "H" para ativar/desativar ESP)",
    "Configurações de Aimbot aqui.\n\n(Em breve!)",
    "Configurações de Misc aqui.\n\n(Em breve!)",
}

local function updateCategory(idx)
    selectedCategory = idx
    for i, btn in ipairs(buttons) do
        btn.BackgroundColor3 = i == idx and Color3.fromRGB(220,200,255) or Color3.fromRGB(235,235,255)
        btn.TextColor3 = i == idx and Color3.fromRGB(55, 20, 90) or Color3.fromRGB(60, 60, 80)
    end
    ContentLabel.Text = categoryContents[idx]
end

for i, btn in ipairs(buttons) do
    btn.MouseButton1Click:Connect(function()
        updateCategory(i)
    end)
end

updateCategory(1)

-- Drag & Drop para o menu principal
local dragging = false
local dragStart
local startPos

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and input.Position.Y < MainFrame.AbsolutePosition.Y + 54 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        MainFrame.BackgroundTransparency = 0.20
    end
end)

MainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
        MainFrame.BackgroundTransparency = 0.08
    end
end)

UIS.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        local newPos = startPos + UDim2.new(0, delta.X, 0, delta.Y)
        newPos = UDim2.new(
            0, math.clamp(newPos.X.Offset, 0, ScreenGui.AbsoluteSize.X - MainFrame.AbsoluteSize.X),
            0, math.clamp(newPos.Y.Offset, 0, ScreenGui.AbsoluteSize.Y - MainFrame.AbsoluteSize.Y)
        )
        MainFrame.Position = UDim2.new(
            0, newPos.X.Offset,
            0, newPos.Y.Offset
        )
        MainFrame.AnchorPoint = Vector2.new(0, 0)
    end
end)

-- Mostrar/ocultar o menu ao clicar no ícone
IconButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- ESC fecha o menu
UIS.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Enum.KeyCode.Escape then
        MainFrame.Visible = false
    end
end)

-- Exemplo da função ESP já integrada (você pode aprimorar conforme suas funções)
local ESP_Ativo = false
local caixas = {}

local function criarESP(jogador)
    if jogador == LocalPlayer then return end
    if caixas[jogador] then
        caixas[jogador]:Destroy()
        caixas[jogador] = nil
    end
    if jogador.Character and jogador.Character:FindFirstChild("HumanoidRootPart") then
        local highlight = Instance.new("Highlight")
        highlight.FillColor = Color3.fromRGB(170, 0, 255)
        highlight.OutlineColor = Color3.fromRGB(200, 120, 255)
        highlight.FillTransparency = 0.8
        highlight.OutlineTransparency = 0.1
        highlight.Adornee = jogador.Character
        highlight.Parent = jogador.Character
        caixas[jogador] = highlight
    end
end

local function removerESP()
    for jogador, highlight in pairs(caixas) do
        if highlight and highlight.Parent then
            highlight:Destroy()
        end
    end
    caixas = {}
end

local function monitorarJogador(jogador)
    if jogador == LocalPlayer then return end
    jogador.CharacterAdded:Connect(function(char)
        if ESP_Ativo then
            criarESP(jogador)
        end
    end)
end

for _, jogador in ipairs(Players:GetPlayers()) do
    monitorarJogador(jogador)
end
Players.PlayerAdded:Connect(monitorarJogador)

Players.PlayerAdded:Connect(function(jogador)
    if ESP_Ativo then
        criarESP(jogador)
    end
end)

Players.PlayerRemoving:Connect(function(jogador)
    if caixas[jogador] then
        caixas[jogador]:Destroy()
        caixas[jogador] = nil
    end
end)

RunService.RenderStepped:Connect(function()
    if ESP_Ativo then
        for _, jogador in ipairs(Players:GetPlayers()) do
            if jogador ~= LocalPlayer and jogador.Character and not caixas[jogador] then
                criarESP(jogador)
            end
        end
    end
end)

-- Exemplo: Ative/desative ESP ao pressionar H se quiser
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.H then
        ESP_Ativo = not ESP_Ativo
        if ESP_Ativo then
            for _, jogador in ipairs(Players:GetPlayers()) do
                criarESP(jogador)
            end
        else
            removerESP()
        end
    end
end)
